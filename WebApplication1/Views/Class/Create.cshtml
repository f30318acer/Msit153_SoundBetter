@model prjMusicBetter.Models.TClass

@{
    ViewData["Title"] = "Create";
}
<style>
    #fDescription {
    height: 200px; /* 設定合適的高度，你可以根據需要調整 */
    resize: vertical; /* 允許垂直調整大小 */
    overflow-y: auto; /* 在高度不足時顯示垂直滾動條 */
    }
    /*留空白用的*/
    .pad {
        padding-top: 20px; /* 設置上邊距擴展的像素值 */
        padding-bottom: 20px; /* 設置下邊距擴展的像素值 */
    }
</style>
<!-- Contact section -->
<section class="contact-section">
    <div class="container-fluid">
        <div class="contact-warp">
            <div class="section-title mb-0">
                <h2>新建課程</h2>
            </div>
            <form id="classForm" method="post" class="contact-from col-lg-8" onsubmit="return validateForm()">
                <div class="row">
                    <input type="hidden" id="fTeacherID" name="fTeacherID" value="@ViewBag.MemberId" />
                    <div class="col-md-6 pad">
                        <label for="fClassName">課程名稱:</label>
                        <input type="text" id="fClassName" name="fClassName" required />
                    </div>
                    <div class="col-md-6 pad">
                        <label for="fPrice">單堂價格:</label>
                        <input type="number" id="fPrice" name="fPrice" required />
                    </div>
                    <div class="col-md-12">
                        <label for="fDescription">課程說明:</label>
                        <textarea id="fDescription" name="fDescription" required></textarea>
                    </div>
                    <div class="col-md-6">
                        <label for="fStartdate">開始日期:</label>
                        <input type="datetime-local" id="fStartdate" name="fStartdate" required />
                    </div>
                    <div class="col-md-6">
                        <label for="fEnddate">結束日期:</label>
                        <input type="datetime-local" id="fEnddate" name="fEnddate" required />
                    </div>
                    <div class="col-md-12 pad">
                        <label for="fSiteID">上課地點:</label>
                        <input type="hidden" id="fSiteID" name="fSiteID" value="1" />
                        <select id="fSiteName" name="fSiteName" required></select><br />
                    </div>
                    <div class="col-md-12 pad">
                        <label for="formFile">圖片:</label>
                        <input type="file" id="formFile" name="formFile" accept="image/*" />
                    </div>
                    <div class="col-md-12 pad">
                        <label for="fMaxStudent">課程人數:</label>
                        <input type="text" id="fMaxStudent" name="fMaxStudent" required value="0"/>
                    </div>
                    <input type="hidden" id="FCurrentStudent" name="FCurrentStudent" value="0" />
                    <div class="col-md-12 pad">
                        <label for="fSkillID">課程類型:</label>
                        <input type="hidden" id="fSkillID" name="fSkillID" value="1" />
                        <select id="fName" name="fName" required></select><br />
                    </div>
                    <div class="col-md-12 pad">
                        <button id="buttonSubmit" type="submit" class="btm">確定建立</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</section>
<!-- Contact end -->


<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    <script>
        //讓上課地點選項顯示fSiteName
        const SiteID = document.querySelector('#fSiteID');
        const SiteName = document.querySelector('#fSiteName');

        const SkillID = document.querySelector('#fSkillID');
        const SkillName = document.querySelector('#fName');

        function load() {
            // 獲取TSites資料
            fetch('@Url.Content("~/Place/List")')
                .then(response => response.json())
                .then(data => {
                    const selectElement = document.getElementById('fSiteName');
                    data.forEach(site => {
                        const option = document.createElement('option');
                        option.value = String(site.fSiteId);  // 使用fSiteID作為值
                        option.text = site.fSiteName; // 顯示fSiteName
                        selectElement.appendChild(option);
                    });
                    // 添加 change 事件監聽器，當選擇改變時觸發
                    selectElement.addEventListener('change', function() {
                    // 將隱藏的 fSiteID 更新為所選擇的 fSiteID
                        SiteID.value = selectElement.value;
                    });
                });

            /////////////////////////////////////////////////////

            // 獲取TSkill資料
            fetch('@Url.Content("~/apiTSkills/OnlyIdName")')
                .then(response => response.json())
                .then(data => {
                    const selectElement = document.getElementById('fName');
                    data.forEach(skill => {
                        const option = document.createElement('option');
                        option.value = String(skill.fSkillId);  // 使用FSkillId作為值
                        option.text = skill.fName; // 顯示FName
                        selectElement.appendChild(option);
                        //console.log(data);
                    });
                    // 添加 change 事件監聽器，當選擇改變時觸發
                    selectElement.addEventListener('change', function() {
                    // 將隱藏的 fSkillID 更新為所選擇的 fSkillID
                        SkillID.value = selectElement.value;
                    });
                });
        }
        load();

        //檢查必填項目是否都已填寫///////////////////////////////////////////////////////////////////////
        
        function validateForm() {
            // 檢查必填項目是否都已填寫
            const requiredFields = document.querySelectorAll('[required]');
            let isValid = true;
            let isAlertShown = false; // 追踪警告是否已經顯示

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    if (!isAlertShown) {
                        alert('請填寫所有必填項目');
                        isAlertShown = true; // 警告已經顯示
                    }
                    isValid = false;
                }
            });
            return isValid;
        }


        //上傳資料///////////////////////////////////////////////////////////////////////

        const btn = document.querySelector('#buttonSubmit');

        btn.addEventListener('click', event => {

            event.preventDefault();//不讓submit運作
            if (validateForm()) {
                //傳整個Form的資料
                const formData = new FormData(document.querySelector('#classForm'));

                fetch('@Url.Content("~/apiTClass/Create")', {
                    method: 'POST',
                    body: formData
                })
                    .then(response => {
                        if (response.ok) {
                            alert("新增成功");
                            location.href = '@Url.Content("~/Members/Memberclass")';
                        }
                    })
            }
        })
    </script>
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
