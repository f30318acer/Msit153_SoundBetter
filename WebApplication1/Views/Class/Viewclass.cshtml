@model prjMusicBetter.Models.TClass
@{
    ViewData["Title"] = "Viewclass";
}

<style>
    .body-container {
        width: 80%;
        max-width: 1100px;
        margin: auto;
        padding: 0;
    }

    .container {
        padding-right: 15px;
        padding-left: 15px;
        margin-right: auto;
        margin-left: auto;
    }

    .course-title {
        margin: 10px auto;
        margin-left: 20px;
        font-size: 26px;
        font-weight: bold;
    }

    .detail-block {
        margin-bottom: 10px;
        display: inline-block;
        width: 100%;
        box-sizing: border-box;
        color: #555;
        text-align: center;
    }

    .detail-title {
        font-weight: bolder;
        border-bottom: 2px solid #fc0254;
        padding-bottom: 10px;
        margin: 20px 0;
        margin-bottom: 10px;
        text-align: left;
    }

    .title-container {
        position: relative;
        background: #FFF;
        padding: 15px;
        border-radius: 0 0 3px 3px;
    }

    .course-container {
        width: 80%;
        margin: 50px auto 20px auto;
        overflow: hidden;
    }

    section {
        background-size: auto;
    }

    .teacher-title {
        font-size: 18px;
        color: #888;
    }

    .profile-wrapper {
        width: 150px;
        height: 150px;
        margin: 10px auto;
    }

    .teacher-name {
        text-align: center;
        font-size: 22px;
        color: #555;
        font-weight: bold;
        margin: 10px 0;
    }

    .teacher-intro {
        text-align: left;
        display: none;
        margin: 20px;
        color: #555;
        white-space: pre-wrap;
    }

    .teacher-seemore {
        text-align: center;
        display: block;
        margin: 20px;
    }

    .songs-details-section {
        padding: 50px 38px 50px;
        background: #f9fcfd;
    }

    .teacher-profile-container {
        text-align: center;
        display: block;
        margin-top: 10px;
    }

    .price {
        text-align: center;
        font-size: 22px;
        color: #555;
        font-weight: bold;
        margin: 50px auto 30px auto;
    }

    .btm {
        height: 60px;
        min-width: 167px;
        right: 0;
        top: 0;
        border: none;
        border-radius: 80px;
        color: #fff;
        font-size: 15px;
        background: #fc0254;
        text-align: center;
        clear: both;
    }
</style>
<section id="title" class="player-section" style="background-image: url('/img/classimg/class_bg.jpg');">
    <div class="player-box">
        <div class="tarck-thumb-warp">
            <div class="tarck-thumb">
                <img alt="輕鬆學配樂！" src="~/img/classimg/@Model.FThumbnailPath">
            </div>
        </div>
        <div class="wave-player-warp">
            <div class="wave-player-info">
                <h2>@Model.FClassName</h2>
                <h4 style="color:gray;">類型：@ViewBag.skillname</h4>
                <h4 style="color:gray;">場地：@ViewBag.SiteName</h4>
                <h4 style="color:gray;">地點：@ViewBag.Address </h4>
            </div>
        </div>
    </div>
</section>
<div id="bodydiv" class="container body-container">
    <div class="row">
        <div class="col-md-6">
            <div class="detail-block">
                <a asp-area="" asp-controller="Members" asp-action="Profile1">
                    <h3 class="detail-title">授課導師</h3>
                    <div class="profile-wrapper">
                        <img src="~/img/Member/@(ViewBag.teacherimg)">
                    </div>
                    <h2 class="teacher-name">@Model.FTeacher</h2>
                    @ViewBag.teacher
                    <span class="teacher-seemore"><span class="glyphicon glyphicon-triangle-right"></span>點此看更多老師資訊</span>
                </a>
            </div>
        </div>
        <div class="col-md-6">
            <div class="detail-block" style="display: flex; flex-direction: column; justify-content: space-between; height: 100%;">
                <h3 class="detail-title">課程資訊</h3>
                <h2 class="price">價格</h2>
                <h3 style="text-align: center">@(Math.Round((decimal)Model.FPrice))/每堂</h3>
                <h2 class="price">日期</h2>
                <h3 style="text-align: center">@Model.FStartdate</h3>
                <h3 style="text-align: center">~</h3>
                <h3 style="text-align: center">@Model.FEnddate</h3>
                <h2 class="price">報名人數</h2>
                <h3 style="text-align: center">@Model.FCurrentStudent/@Model.FMaxStudent</h3>
                <div>
                    <form asp-controller="ShoppingCart" asp-action="List" onsubmit="return checkQuota()" method="get" style="text-align: center; margin: 20px auto;">
                        <button name="createClass" class="btm">購買課程</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Songs details section -->
    <section class="songs-details-section">
        <div class="detail-block">
            <h3 class="detail-title">課程簡介</h3>
            <span class="detail-wrapper">
                @Model.FDescription
            </span>
        </div>
    </section>
</div>
<div id="order" class="course-container">
    <!-- Similar Songs section -->
    <section class="similar-songs-section">
        <div class="container-fluid">
            <h3>你可能會想看的其他課程</h3>
            <div id="divList" class="row playlist-area">
            <!--List內容-->
            </div>
        </div>
    </section>
    <!-- Similar Songs section end -->
</div>
@section Scripts {
    <script>
        function checkQuota() {
        // 檢查是否符合課程名額條件
        if (@Model.FCurrentStudent < @Model.FMaxStudent) {
            // 符合條件，執行頁面跳轉
            return true;
        } else {
            // 不符合條件，顯示提醒並阻止表單提交
            alert("不好意思，課程名額已滿");
            return false;
        }
    }

    function firstLoad(pageNumber) {
            const divList = $('#divList')
            //讀取Json資料
            const SkillId = @Model.FSkillId
            console.log(SkillId);
            $.getJSON(`/apiTClass/QueryBySkillID?id=${SkillId}`, function (datas) {
                console.log(datas);

                //獲得限定頁面資料
                //slice(a,b) 陣列datas第a項到第b項的所有資料
                //這裡是第0項到第4項
                const limitdatas = datas.slice(0, 4);

                //做出一個空的容器來存放div
                const docFrag = $(document.createDocumentFragment())

                //讀出每個Json物件
                $.each(limitdatas, function (index, item) {
                    //const descriSub = item.fDescription.length > 15 ? item.fDescription.substring(0, 15) + '...' : item.fDescription;
                    const card = $(
                        `<div class="mix col-lg-3 col-md-4 col-sm-6 genres">
                            <a href="/Class/Viewclass?id=${item.fClassId}">
                                <div class="playlist-item">
                                    <img src="/img/classimg/${item.fThumbnailPath}" alt="">
                                    <h5>${item.fClassName}</h5>
                                </div>
                            </a>
                        </div>`);
                    docFrag.append(card);//.append()將一筆div放入容器中
                })
                divList.html(docFrag)//.html()一次將全部的資料都上傳
            })
        }
        firstLoad(1);
    </script>
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}