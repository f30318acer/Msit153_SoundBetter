
@{
    ViewData["Title"] = "List";
}


<!-- Playlist section -->
<section class="playlist-section spad">
	<div class="container-fluid">
		<div class="row mb-4">
			<div class="section-title col-lg-3">
				<h2>找專案</h2>
			</div>
			<div class="container col-lg-9">
				<div class="text-right">
					<select id="selectStyle" class="form-select"></select>
					<input type="text" name="keywords" placeholder="專案" />
					<button type="button" class="btn btn-secondary">搜尋</button>
					<a href="~/Project/Create" type="button" class="btn btn-success">建立專案</a>
				</div>
			</div>
		</div>
		<div class="clearfix"></div>
		<div id="divList" class="row playlist-area">
			<!--List內容-->
		</div>
		<div id="pagination-container"></div>
	</div>
</section>
<!-- Playlist section end -->
<!-- PageButtom -->
<section class="help-section spad pt-0">
	<div class="container">
		<div id="pageButtons" class="text-center">
			<!--PageButtom-->
		</div>
	</div>
</section>
<!-- Help section end -->
<section class="help-section spad pt-0">
	<div class="container">
		<div class="row">
			<div class="col-lg-6">
				<div class="section-title mb-0 pb-4">
					<h2>Need Help to find music? </h2>
				</div>
				<p>Consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Quis ipsum suspendisse ultrices gravida. Risus commodo viverra maecenas accumsan lacus vel facilisis. </p>
			</div>
			<div class="col-lg-6">
				<div class="d-flex h-100 align-items-end">
					<form class="search-form">
						<input type="text" placeholder="Hit it">
						<button>Search</button>
					</form>
				</div>
			</div>
		</div>
	</div>
</section>
<a href=""></a>
<!-- Help section end -->

@section Scripts{
	<script>
		const selStyle = document.querySelector('#selectStyle');
		const pageButtonsContainer = $('#pageButtons');
		const onePage = 8;

		function load(pageNumber) {
			const divList = $('#divList')
			$.getJSON('/apiTProjects/List', function (datas) {
				console.log(datas);
				//獲得限定頁面資料
				const limitdatas = datas.slice((pageNumber - 1) * onePage, ((pageNumber - 1) * onePage) + onePage);

				const docFrag = $(document.createDocumentFragment())
				$.each(limitdatas, function (index, item) {
					const descriSub = item.fDescription.length > 15 ? item.fDescription.substring(0, 15) + '...' : item.fDescription;
					const card = $(
						`<a class="mix col-lg-3 col-md-4 col-sm-6" href="/Project/Details/${item.fProjectId}">
							<div class="playlist-item">
										<img src="/img/project/${item.fThumbnailPath}" alt = "" >
								<h5>${item.fName}</h5>
								<p>${descriSub}</p>
							</div>
						</a>`);
					docFrag.append(card);
				})
				divList.html(docFrag)
			})
		}
		load(1);

		//Style選擇器
		async function loadStyle() {
			const response = await fetch('@Url.Content("~/apiTStyle/List")');
			const data = await response.json();
			const style = data.map(s => `<option value="${s.fStyleId}">${s.fName}</option>`);
			selStyle.innerHTML = style.join("");
		}
		loadStyle();

		//PageButtom
		async function loadPage(){
			const response = await fetch('@Url.Content("~/apiTProjects/List")');
			const data = await response.json();
			const dataCount = data.length;
			const pageCount = Math.ceil(dataCount / onePage);
			console.log(pageCount);
			for (let i = 1; i <= pageCount; i++) {
				const button = $(`<button class="btn btn-secondary mr-2">${i}</button>`);
				button.click(function () {
					load(i);
				});
				pageButtonsContainer.append(button);
			}
		}
		loadPage();
	</script>
}