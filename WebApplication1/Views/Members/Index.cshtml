@model prjMusicBetter.Models.Dtos.FMemberDto;



@{
    ViewData["Title"] = "Index";
    Layout = Url.Content("~/Views/Shared/_Layout.cshtml");
    string display = "MemberInfo";
    if (!string.IsNullOrEmpty(ViewBag.Display))
    {
        display = ViewBag.Display;
    }
    

}


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Noto Sans', sans-serif;
    }
</style>
<body >
    <div class="container row p-2 mx-auto border border-dark rounded-3 m-3">
        <div class="col-3  border rounded-3 p-2 color-FCFCFC">
            <div class="p-3">
                <div class="circle-size-150 mx-auto">
                    <form name="formUploadPhoto">
                        @{
                            if (Model.FPhotoPath != null)
                            {
                                <div>
                                    <div class="my-4 mx-auto btnUpload cursor-pointer" style="width:150px; height:150px">
                                        <img src="@Url.Content("~/img/Member/")@Model.FPhotoPath" data-filename="@Model.FPhotoPath" id="imgMemberPhoto" class="circle-size-150 cover rounded-circle" />
                                    </div>
                                    <div class="width-400 mx-auto">
                                        <input type="file" class="form-control" style="visibility:hidden" id="inputUpload" name="Photo">
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div>
                                    <div class="my-4 mx-auto btnUpload cursor-pointer" style="width:150px; height:150px">
                                        <img src="@Url.Content("~/img/Member/default.jpg")" id="imgMemberPhoto" class="circle-size-150 cover rounded-circle" />
                                    </div>
                                    <div class="width-400 mx-auto">
                                        <input type="file" class="form-control" style="visibility:hidden" id="inputUpload" name="Photo" />
                                    </div>
                                </div>
                            }
                        }
                    </form>
                </div>
                <div class="mt-3">
                    <input type="hidden" name="fMemberID" value="@Model.FMemberID" />
                    <input type="hidden" name="" value="@display" id="display" class="form-control">
                </div>
            </div>
            <div class="m-3 justify-content-center">
                <div class=" border-bottom align-items-center d-flex">
                    <div class="flex items-center justify-between px-2 py-1 bg-white" id="info">
                        <img class="d-flex w-25-h-25" src="@Url.Content("~/img/MyMemberphoto/user.png")" alt="">
                        <span class="text-lg font-semibold mb-4">個人資料</span>
                    </div>
                </div>
                <div class=" border-bottom align-items-center d-flex">
                    <a href="@Url.Content("~/Members/Memberclass")">
                        <div class="flex items-center justify-between px-2 py-1 bg-white" id="myclass">
                            <img class="d-flex w-25-h-25" src="@Url.Content("~/img/MyMemberphoto/webinar.png")" alt="">
                            <span class="text-lg font-semibold mb-4">課程查詢</span>

                        </div>
                    </a>
                </div>
                <div class=" border-bottom align-items-center d-flex">
                    <div class="flex items-center justify-between px-2 py-1 bg-white" id="myWorks">
                        <img class="d-flex w-25-h-25" src="@Url.Content("/img/MyMemberphoto/music.png")" alt="">
                        <span class="text-lg font-semibold mb-4">我的作品(@ViewBag.TotalWorks)</span>
                    </div>
                </div>
                <div class=" border-bottom align-items-center d-flex">
                    <div class="flex items-center justify-between px-2 py-1 bg-white" id="myProject">
                        <img class="d-flex w-25-h-25" src="@Url.Content("/img/MyMemberphoto/project.png")" alt="">
                        <span class="text-lg font-semibold mb-4">我的專案(@ViewBag.TotalProjects)</span>

@*                         <span class="ml-2 text-lg">Total: @ViewBag.TotalProjects</span>
 *@                    </div>
                </div>
                <div class=" border-bottom align-items-center d-flex">
                    <div class="flex items-center justify-between px-2 py-1 bg-white" id="myMemberSite">
                        <img class="d-flex w-25-h-25" src="@Url.Content("/img/MyMemberphoto/location.png")" alt="">
                        <span class="text-lg font-semibold mb-4">我的場地(@ViewBag.TotalSites)</span>

                    </div>
                </div>
                <div class=" border-bottom align-items-center d-flex">
                    <div class="flex items-center justify-between px-2 py-1 bg-white" id="myMemberCoupon">
                        <img class="d-flex w-25-h-25" src="@Url.Content("/img/MyMemberphoto/coupon.png")" alt="">
                        <span class="text-lg font-semibold mb-4">我的優惠券(@ViewBag.TotalCoupons)</span>

                        @* <a href="@Url.Content("~/Members/CoolPon")" class="btn btn-dark"></a> *@
                    </div>
                </div>
                <div class=" border-bottom align-items-center d-flex">
                    <div class="flex items-center justify-between px-2 py-1 bg-white" id="myfriends">
                        <img class="d-flex w-25-h-25" src="@Url.Content("/img/MyMemberphoto/add-friend.png")" alt="">
                        <span class="text-lg font-semibold mb-4">我的追隨(@ViewBag.TotalFriends)</span>

@*                         <span class="ml-2 text-lg">Total: @ViewBag.TotalFriends</span>
 *@                        @* <a href="@Url.Content("~/Members/CoolPon")" class="btn btn-dark"></a> *@
                    </div>
                </div>
                <div class=" border-bottom align-items-center d-flex">
                    <div class="flex items-center justify-between px-2 py-1 bg-white" id="myBlackList">
                        <img class="d-flex w-25-h-25" src="@Url.Content("/img/MyMemberphoto/businessman.png")" alt="">
                        <span class="text-lg font-semibold mb-4">|黑名單(@ViewBag.TotalBlackList)</span>
@*                         <span class="ml-2 text-lg">Total: @ViewBag.TotalBlackList</span>
 *@                        @* <a href="@Url.Content("~/Members/CoolPon")" class="btn btn-dark"></a> *@
                    </div>
                </div>
                <div class=" border-bottom align-items-center d-flex">
                    <div class="flex items-center justify-between px-2 py-1 bg-white" id="password">
                        <img class="d-flex w-25-h-25" src="@Url.Content("/img/MyMemberphoto/forgot.png")" alt="">
                        <span class="text-lg font-semibold mb-4">修改密碼</span>

                    </div>
                </div>
            </div>
        </div>
        <div class="col-9 p-2" id="divPartial">
        </div>
    </div>
</body>

@section Scripts
    {
    <script>
        let MemberID = 0;
        async function GetMemberFileName() {
            const response = await fetch(`@Url.Content("~/apiMembers/GetFMemberPhoto")`)
            const data = await response.json();

            let displayFileName = data.fphotoPath == null ? 'default.jpg' : data.fphotoPath;

            ReloadPhoto(displayFileName)
        }
        function ReloadPhoto(displayFileName) {

            let fphotoPath = `@Url.Content("~/img/Member/")${displayFileName}`

            $("#imgMemberPhoto").attr("src", fphotoPath)
        }

        $('.btnUpload').on('click', function () {
            $('#inputUpload').trigger('click');
        })

        const photo = document.querySelector("#inputUpload");
        photo.addEventListener('change', async function () {
            const files = photo.files
            if (files.length == 0) {
                GetMemberFileName()
            }
            else {
                const formData = new FormData(document.formUploadPhoto);
                const response = await fetch('@Url.Content("~/apiMembers/UploadPhoto")', {
                    body: formData,
                    method: 'POST'
                });
                const datas = await response.json();
                if (datas.statusCode == 200) {
                    Swal.fire(
                        '更新成功!',
                        '您成功更新了照片!',
                        'success'
                    )
                    GetMemberFileName()
                }
            }
        })

        $(document).ready(function () {
            const display = $("#display").val();
            loadPage(display)
        })


        function loadPage(display) {
            $('#divPartial').load(`@Url.Content("~/Members/")${display}`)
        }
        //將會員資料回傳至這裡
        $('#info').click(function () {
            $('#divPartial').load('@Url.Content("~/Members/MemberInfo")')
        })




        //將會員資料(好友)回傳至這裡
        $('#myfriends').click(function () {
            $('#divPartial').load('@Url.Content("~/Members/friends")')
        })
        //將會員資料(黑名單)回傳至這裡
        $('#myBlackList').click(function () {
            $('#divPartial').load('@Url.Content("~/Members/blackList")')
        })
        //將會員資料(優惠券)回傳至這裡

        $('#myMemberCoupon').click(function () {
            $('#divPartial').load('@Url.Content("~/Members/MemberCoupon")')
        })
        //將會員資料(作品)回傳至這裡

        $('#myWorks').click(function () {
            $('#divPartial').load('@Url.Content("~/Members/MemberWorks")')
        })
        //將會員資料(專案)回傳至這裡

        $('#myProject').click(function () {
            $('#divPartial').load('@Url.Content("~/Members/MemberProject")')
        })
        //將會員資料(場地)回傳至這裡

        $('#myMemberSite').click(function () {
            $('#divPartial').load('@Url.Content("~/Members/MemberSite")')
        })

        //忘記密碼
        $('#password').click(function () {
            $('#divPartial').load('@Url.Content("~/Members/MemberPassword")')
        })
      
        $("#divPartial").on("click", ".btnEdit", function (event) {
            event.preventDefault()
            let id = $(this).data("id");
            $('#divPartial').load(`@Url.Content("~/Members/MemberInfoEdit/")${id}`)
        })
        $("#divPartial").on("click", ".btnEditCancel", function (event) {
            event.preventDefault()
            $('#divPartial').load('@Url.Content("~/Members/MemberInfo")')
        })
  //忘記密碼
        $("#divPartial").on("click", ".btnPasswordCancel", function (event) {
            event.preventDefault()
            $('#divPartial').load('@Url.Content("~/Members/MemberInfo")')
        })
    </script>
}